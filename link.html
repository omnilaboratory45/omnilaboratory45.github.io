<!DOCTYPE HTML>
<html lang="ko-KR">
    <head>
        <meta charset="UTF-8">
        <script type="text/javascript">
            function getAlias() {
                const urlParams = new URLSearchParams(window.location.search);
                let alias = urlParams.get("to");
                return alias === null ? "index" : alias;
            }

            function getFullLink(alias) {
                return fetch('./static/links.json')
                    .then(res => res.json())
                    .then(data => {
                        const links = data["links"];
                        if (!(alias in links)) {
                            return null;
                        }
                        /** @type {string} */
                        const link = links[alias];
                        if (link.startsWith("https://") || link.startsWith("http://")) {
                            return link;
                        } else {
                            return link;
                        }
                    }).catch(err => {
                            return null;
                        }
                    );
            }

            function redirect(alias) {
                getFullLink(alias).then(link => {
                    if (link == null) {
                        link = "/";
                        // return whenFailed();
                    }
                    window.location.href = link;
                    const message = `If you are not redirected automatically, follow this <a href="${link}">link</a>.`;
                    document.getElementById("redirect").innerHTML = message;
                });
            }

            function whenFailed() {
                const message = `Unknown alias. If you want to see index of this website, go ahead <a href=".">here</a>.`
                document.getElementById("redirect").innerHTML = message;
            }

            // redirect(getAlias());
            document.getElementById("redirect").innerText = `Redirecting to ${getAlias()} at ${getFullLink(getAlias())}`
        </script>
        <title>Page Redirection</title>
    </head>
    <body>
        <div id="redirect">Redirecting...</div>
        <noscript>
            <style> #redirect { display: none } </style>
            Redirecting doesn't work without JavaScript. Enable JavaScript to redirect.
        </noscript>
    </body>
</html>